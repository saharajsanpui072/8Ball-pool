<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ARMY SAHARAJ - Supreme Commander</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

    <style>
        :root { --primary: #3b82f6; --bg: #080a12; --card: #151a2d; --accent: #fbbf24; --success: #10b981; --danger: #ef4444; }
        body { background: var(--bg); color: #fff; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 10px; }
        .admin-container { max-width: 650px; margin: auto; }
        
        /* Header */
        .brand-header { text-align: center; padding: 20px; background: linear-gradient(90deg, #1e3a8a, #3b82f6); border-radius: 15px; margin-bottom: 15px; border-bottom: 4px solid var(--accent); box-shadow: 0 4px 15px rgba(0,0,0,0.5); }
        .brand-header h1 { margin: 0; letter-spacing: 2px; font-size: 24px; text-transform: uppercase; }

        /* Navigation */
        .nav-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 15px; }
        .nav-box { background: var(--card); padding: 12px; border-radius: 10px; text-align: center; cursor: pointer; border: 1px solid #334155; font-size: 11px; font-weight: bold; text-transform: uppercase; transition: 0.3s; }
        .nav-box.active { background: var(--primary); color: white; border-color: white; }

        /* Sections */
        .section { display: none; background: var(--card); padding: 20px; border-radius: 20px; border: 1px solid #334155; }
        .section.active { display: block; animation: fadeIn 0.3s; }

        /* Dashboard & Timer */
        .dashboard-box { background: #000; padding: 25px 15px; border-radius: 25px; text-align: center; margin-bottom: 15px; border: 2px solid #334155; }
        .timer-display { font-size: 55px; font-weight: bold; color: var(--accent); line-height: 1; }
        
        .history-line { display: flex; justify-content: center; gap: 8px; margin-top: 20px; min-height: 40px; }
        .res-dot { width: 38px; height: 38px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-weight: 900; font-size: 16px; border: 1px solid rgba(255,255,255,0.1); }
        .res-B { background: var(--success); color: white; }
        .res-S { background: var(--danger); color: white; }

        /* Control Buttons */
        .btn-row { display: flex; gap: 10px; margin-top: 15px; }
        .btn-action { border: none; padding: 15px; border-radius: 12px; cursor: pointer; font-weight: bold; color: white; transition: 0.3s; text-transform: uppercase; flex: 1; font-size: 14px; }
        
        /* Command Highlight (Black Mode) */
        .active-mode { background: #000 !important; border: 2px solid #fff !important; transform: scale(0.96); box-shadow: 0 0 15px rgba(255,255,255,0.2); }

        /* User Table & Actions */
        .scroll-container { max-height: 400px; overflow-y: auto; margin-top: 15px; }
        table { width: 100%; border-collapse: collapse; font-size: 13px; }
        th, td { padding: 12px; border-bottom: 1px solid #334155; text-align: left; }
        
        .bal-input { width: 55px; background: #0b1120; color: #fff; border: 1px solid #334155; padding: 6px; border-radius: 6px; text-align: center; }
        .btn-mini { padding: 7px 10px; border-radius: 6px; border: none; cursor: pointer; font-weight: bold; margin-left: 2px; }
        
        input[type="email"], input[type="text"], input[type="number"] { width: 100%; padding: 12px; margin-top: 10px; background: #0b1120; border: 1px solid #334155; color: #fff; border-radius: 10px; box-sizing: border-box; }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

<div class="admin-container">
    <div class="brand-header">
        <h1>ARMY SAHARAJ</h1>
    </div>

    <div class="nav-grid">
        <div class="nav-box active" onclick="switchTab('control', this)">Game</div>
        <div class="nav-box" onclick="switchTab('users', this)">Players</div>
        <div class="nav-box" onclick="switchTab('payments', this)">Payments</div>
        <div class="nav-box" onclick="switchTab('create', this)">New ID</div>
    </div>

    <div id="control" class="section active">
        <div class="dashboard-box">
            <div style="color: #64748b; font-size: 12px; margin-bottom: 8px;">PERIOD: <span id="current-period-id" style="color: #fff;">---</span></div>
            <div class="timer-display" id="admin-timer">00:00</div>
            <div class="history-line" id="history-line-row"></div>
        </div>
        
        <div style="display: flex; justify-content: space-between; padding: 0 10px; font-weight: bold;">
            <span style="color: var(--success);">BIG POOL: ‚Çπ<span id="big-total">0</span></span>
            <span style="color: var(--danger);">SMALL POOL: ‚Çπ<span id="small-total">0</span></span>
        </div>

        <div class="btn-row">
            <button id="btn-Big" class="btn-action" style="background:var(--success);" onclick="setMode('manual', 'Big')">Force Big</button>
            <button id="btn-Small" class="btn-action" style="background:var(--danger);" onclick="setMode('manual', 'Small')">Force Small</button>
        </div>
        <button id="btn-auto" class="btn-action" style="background:var(--primary); width: 100%; margin-top: 10px;" onclick="setMode('auto', '')">üõ°Ô∏è Anti-Loss Smart Mode</button>
    </div>

    <div id="users" class="section">
        <h3>User Management</h3>
        <div class="scroll-container">
            <table>
                <thead><tr><th>UID</th><th>Balance</th><th>Actions</th></tr></thead>
                <tbody id="player-table"></tbody>
            </table>
        </div>
    </div>

    <div id="payments" class="section">
        <h4 style="color:var(--success);">üì• Deposits</h4>
        <div class="scroll-container" style="max-height: 180px;"><table id="deposit-table" style="width:100%;"></table></div>
        <h4 style="color:var(--danger); margin-top: 20px;">üì§ Withdrawals</h4>
        <div class="scroll-container" style="max-height: 180px;"><table id="withdraw-table" style="width:100%;"></table></div>
    </div>

    <div id="create" class="section">
        <h3>Register Official ID</h3>
        <input type="email" id="c-email" placeholder="Email Address">
        <input type="text" id="c-pass" placeholder="Password">
        <input type="text" id="c-uid" placeholder="Custom UID">
        <button class="btn-action" style="background:var(--primary); width:100%; margin-top:15px;" onclick="registerUser()">Create Player</button>
    </div>
</div>

<script>
    // --- Firebase Engine ---
    const firebaseConfig = {
        apiKey: "AIzaSyAh1s75e5uKhyAb0YtlK5zFw9fna9-UyHw",
        authDomain: "saharaj-paid.firebaseapp.com",
        databaseURL: "https://saharaj-paid-default-rtdb.firebaseio.com",
        projectId: "saharaj-paid",
        storageBucket: "saharaj-paid.firebasestorage.app",
        appId: "1:39526305282:android:e0562119c2e9a2612ea11b"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function switchTab(id, el) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.nav-box').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active'); el.classList.add('active');
    }

    // --- Timer & Game Result Logic ---
    setInterval(() => {
        const now = new Date();
        const sec = now.getSeconds();
        const pId = `${now.getFullYear()}${(now.getMonth()+1).toString().padStart(2,'0')}${now.getDate().toString().padStart(2,'0')}${now.getHours().toString().padStart(2,'0')}${now.getMinutes().toString().padStart(2,'0')}`;
        
        document.getElementById('admin-timer').innerText = `00:${(60-sec).toString().padStart(2, '0')}`;
        document.getElementById('current-period-id').innerText = pId;
        
        if (sec === 59) {
            db.ref('admin_control').once('value', snap => {
                const ctrl = snap.val() || { mode: 'auto' };
                db.ref('live_bets').once('value', bSnap => {
                    const bets = bSnap.val() || { Big: 0, Small: 0 };
                    let win = (ctrl.mode === 'manual') ? ctrl.target : (parseFloat(bets.Big) > parseFloat(bets.Small) ? 'Small' : 'Big');
                    db.ref('game_history/' + pId).set({ period: pId, result: win, timestamp: Date.now() });
                    db.ref('live_bets').set({ Big: 0, Small: 0 });
                });
            });
        }
    }, 1000);

    // --- Admin Commands ---
    function setMode(mode, target) { db.ref('admin_control').set({ mode, target }); }

    db.ref('admin_control').on('value', snap => {
        const d = snap.val() || { mode: 'auto' };
        const bB = document.getElementById('btn-Big'), bS = document.getElementById('btn-Small'), bA = document.getElementById('btn-auto');
        if(!bB) return;
        [bB, bS, bA].forEach(b => b.classList.remove('active-mode'));
        if (d.mode === 'manual') document.getElementById('btn-' + d.target).classList.add('active-mode');
        else bA.classList.add('active-mode');
    });

    // 10 Game History Dots
    db.ref('game_history').limitToLast(10).on('value', snap => {
        const row = document.getElementById('history-line-row'); row.innerHTML = "";
        let entries = []; snap.forEach(c => entries.push(c.val()));
        entries.reverse().forEach(h => {
            row.innerHTML += `<div class="res-dot ${h.result === 'Big' ? 'res-B' : 'res-S'}">${h.result[0]}</div>`;
        });
    });

    // --- User Actions (Balance, Ban, Delete) ---
    function adjBal(id, isAdd) {
        const input = document.getElementById('amt-' + id);
        const val = parseFloat(input.value);
        if(!val) return alert("Enter Amount");
        const ref = db.ref('users/' + id + '/balance');
        ref.once('value', s => {
            let res = isAdd ? ((s.val()||0) + val) : ((s.val()||0) - val);
            ref.set(res < 0 ? 0 : res);
            alert("Balance Updated!");
            input.value = "";
        });
    }

    function toggleBan(id, status) {
        db.ref('users/' + id).update({ isBanned: !status });
        alert(!status ? "User Banned!" : "User Unbanned!");
    }

    function deleteUser(id, uid) {
        if(confirm("Permanently delete " + uid + "?")) {
            db.ref('users/' + id).remove();
            alert("Deleted!");
        }
    }

    // Render Players Table
    db.ref('users').on('value', s => {
        const list = document.getElementById('player-table'); list.innerHTML = "";
        s.forEach(c => {
            const d = c.val(); const id = c.key;
            list.innerHTML += `<tr><td>${d.uid} ${d.isBanned ? 'üö´' : ''}</td><td>‚Çπ${d.balance || 0}</td><td>
                <input type="number" id="amt-${id}" class="bal-input" placeholder="0">
                <button onclick="adjBal('${id}',true)" class="btn-mini" style="background:var(--success); color:#fff;">+</button>
                <button onclick="adjBal('${id}',false)" class="btn-mini" style="background:var(--danger); color:#fff;">-</button>
                <button onclick="toggleBan('${id}',${d.isBanned || false})" class="btn-mini" style="background:#64748b; color:#fff;">${d.isBanned?'U':'B'}</button>
                <button onclick="deleteUser('${id}','${d.uid}')" class="btn-mini" style="background:#ff4757; color:#fff;">üóëÔ∏è</button>
            </td></tr>`;
        });
    });

    // Live Bets Sync
    db.ref('live_bets').on('value', s => {
        const d = s.val() || { Big: 0, Small: 0 };
        document.getElementById('big-total').innerText = d.Big || 0;
        document.getElementById('small-total').innerText = d.Small || 0;
    });

    // Payment Helpers
    db.ref('deposit_requests').on('value', snap => {
        const list = document.getElementById('deposit-table'); list.innerHTML = "";
        snap.forEach(c => {
            const r = c.val(); if(r.status === "Pending") {
                list.innerHTML += `<tr><td>${r.uid}</td><td>‚Çπ${r.amount}</td><td>
                    <button onclick="appDep('${c.key}','${r.uid}',${r.amount})" style="background:var(--success); color:#fff; border:none; padding:5px; border-radius:5px;">‚úî Success</button>
                </td></tr>`;
            }
        });
    });

    function appDep(k, u, a) {
        db.ref('users').orderByChild('uid').equalTo(u).once('value', s => { s.forEach(x => x.ref.update({ balance: x.val().balance + a })); });
        db.ref('deposit_requests/'+k).update({ status: 'Success' });
    }

    db.ref('withdraw_requests').on('value', snap => {
        const list = document.getElementById('withdraw-table'); list.innerHTML = "";
        snap.forEach(c => {
            const r = c.val(); if(r.status === "Pending") {
                list.innerHTML += `<tr><td>${r.uid}</td><td>‚Çπ${r.amount}</td><td>
                    <button onclick="db.ref('withdraw_requests/${c.key}').update({status:'Success'})" style="background:var(--success); color:#fff; border:none; padding:5px; border-radius:5px;">‚úî Paid</button>
                </td></tr>`;
            }
        });
    });

    function registerUser() {
        const e = document.getElementById('c-email').value, p = document.getElementById('c-pass').value, u = document.getElementById('c-uid').value;
        if(!e || !p || !u) return alert("Fill all fields");
        firebase.auth().createUserWithEmailAndPassword(e, p).then(cred => {
            db.ref('users/' + cred.user.uid).set({ email: e, uid: u, balance: 0, isBanned: false });
            alert("ID Created!");
        }).catch(err => alert(err.message));
    }
</script>
</body>
</html>
